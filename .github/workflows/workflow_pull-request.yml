name: Pull request

on:
  workflow_call:
    inputs:
      RUN_FORMATTING:
        description: Whether to run the `format:check` npm script
        type: string
        default: true
      RUN_INFRA_TESTS:
        description: Whether to run infra tests using `test:infra` npm script
        type: string
        default: true
      RUN_LINTER:
        description: Whether to run the `lint` npm script
        type: string
        default: true
      RUN_RAIN_FORMAT_VERIFY:
        description: Whether to verify template format by running the `infra:format:verify` npm script
        type: string
        default: false
      RUN_SAM_VALIDATE:
        description: Whether to run SAM validate lint on templates
        type: string
        default: true
      RUN_SONARQUBE:
        description: Whether to run SonarQube checks. Needs RUN_UNIT_TESTS to be true.
        type: string
        default: true
      RUN_UNIT_TESTS:
        description: Whether to run unit tests using `test:unit` npm script
        type: string
        default: true
      WORKING_DIRECTORY:
        description: Path to working directory in repo
        required: true
        type: string
      PRIVATE_PACKAGES_REQUIRED:
        description: Whether private packages must be installed
        type: string
        default: false
      RUN_PACT_TESTS:
        description: Whether to run pact tests using `test:pact:ci` npm script
        type: string
        default: false
    secrets:
      SONAR_TOKEN:
        description: The token used for secure access to the SonarQube platform
        required: false

jobs:
  run-test-suite:
    name: Run test suite
    uses:
      ./.github/workflows/job_test-suite.yml
    with:
      RUN_INFRA_TESTS: ${{ inputs.RUN_INFRA_TESTS }}
      RUN_UNIT_TESTS: ${{ inputs.RUN_UNIT_TESTS }}
      RUN_SONARQUBE: ${{ inputs.RUN_SONARQUBE }}
      WORKING_DIRECTORY: ${{ inputs.WORKING_DIRECTORY }}
      PRIVATE_PACKAGES_REQUIRED: ${{ inputs.PRIVATE_PACKAGES_REQUIRED }}
      RUN_PACT_TESTS: ${{ inputs.RUN_PACT_TESTS }}
    secrets: inherit

