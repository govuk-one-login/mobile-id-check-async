#!/bin/sh

# An example hook script to verify what is about to be committed.
# Called by "git commit" with no arguments.  The hook should
# exit with non-zero status after issuing an appropriate message if
# it wants to stop the commit.

set -e

# Get git root directory
GIT_ROOT=$(git rev-parse --show-toplevel)

# Change to backend-api directory and run existing checks
cd "$GIT_ROOT/backend-api" || exit 1

echo "Running lint and format checks..."
npm run lint
npm run format:check

echo "Merging CloudFormation templates..."
# Change back to root directory to run template verification
cd "$GIT_ROOT" || exit 1
"$GIT_ROOT/helper-scripts/merge-templates.script.sh" merge

echo "Verifying CloudFormation templates..."
# Change back to root directory to run template verification
cd "$GIT_ROOT" || exit 1
"$GIT_ROOT/helper-scripts/merge-templates.script.sh" verify

# Exit with the verification result
exit $?